{"ast":null,"code":"import axios from 'axios';\nexport default async function itemsHandler(req, res) {\n  const {\n    query: {\n      q\n    },\n    method\n  } = req;\n\n  try {\n    var _data$available_filte, _data$available_filte2;\n\n    const {\n      data\n    } = await axios.get(`https://api.mercadolibre.com/sites/MLA/search?q=${q}`);\n    const findCategories = (_data$available_filte = data.available_filters) === null || _data$available_filte === void 0 ? void 0 : (_data$available_filte2 = _data$available_filte.filter(cat => cat.id === 'category')[0]) === null || _data$available_filte2 === void 0 ? void 0 : _data$available_filte2.values;\n    const categories = findCategories ? findCategories.map(val => val.name) : [];\n    var arr = findCategories ? findCategories.map(val => val.results) : [];\n    var max = Math.max(...arr);\n    const breadCrumb = findCategories === null || findCategories === void 0 ? void 0 : findCategories.filter(cat => cat.results === max)[0];\n    console.log(breadCrumb);\n    const items = data.results.map(item => {\n      return {\n        id: item.id,\n        title: item.title,\n        price: {\n          currency: item.currency_id,\n          amount: item.price,\n          decimals: item.price - Math.floor(item.price) //no entendi bien de donde sacar los decimales, asi que lo calculo respecto al amount\n\n        },\n        picture: item.thumbnail,\n        condition: item.condition,\n        free_shipping: item.shipping.free_shipping,\n        state: item.seller_address.state.name\n      };\n    });\n\n    switch (method) {\n      case 'GET':\n        res.status(200).json({\n          author: {\n            name: 'Juan Manuel',\n            lastname: 'Barreto Zacarias'\n          },\n          categories: categories,\n          items: items\n        });\n        break;\n\n      default:\n        res.setHeader('Allow', ['GET']);\n        res.status(405).end(`Method ${method} Not Allowed`);\n    }\n  } catch (error) {\n    console.log(error);\n  }\n}","map":{"version":3,"sources":["C:/Users/circo/OneDrive/Documentos/repos/examen ml/TestML/pages/api/items.js"],"names":["axios","itemsHandler","req","res","query","q","method","data","get","findCategories","available_filters","filter","cat","id","values","categories","map","val","name","arr","results","max","Math","breadCrumb","console","log","items","item","title","price","currency","currency_id","amount","decimals","floor","picture","thumbnail","condition","free_shipping","shipping","state","seller_address","status","json","author","lastname","setHeader","end","error"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,eAAe,eAAeC,YAAf,CAA4BC,GAA5B,EAAiCC,GAAjC,EAAsC;AACnD,QAAM;AACJC,IAAAA,KAAK,EAAE;AAAEC,MAAAA;AAAF,KADH;AAEJC,IAAAA;AAFI,MAGFJ,GAHJ;;AAIA,MAAI;AAAA;;AACF,UAAM;AAAEK,MAAAA;AAAF,QAAW,MAAMP,KAAK,CAACQ,GAAN,CAAW,mDAAkDH,CAAE,EAA/D,CAAvB;AACA,UAAMI,cAAc,4BAAGF,IAAI,CAACG,iBAAR,oFAAG,sBAAwBC,MAAxB,CAA+BC,GAAG,IAAIA,GAAG,CAACC,EAAJ,KAAW,UAAjD,EAA6D,CAA7D,CAAH,2DAAG,uBAAiEC,MAAxF;AACA,UAAMC,UAAU,GAAGN,cAAc,GAAGA,cAAc,CAACO,GAAf,CAAmBC,GAAG,IAAIA,GAAG,CAACC,IAA9B,CAAH,GAAyC,EAA1E;AACA,QAAIC,GAAG,GAAGV,cAAc,GAAGA,cAAc,CAACO,GAAf,CAAmBC,GAAG,IAAIA,GAAG,CAACG,OAA9B,CAAH,GAA4C,EAApE;AACA,QAAIC,GAAG,GAAGC,IAAI,CAACD,GAAL,CAAS,GAAGF,GAAZ,CAAV;AACA,UAAMI,UAAU,GAAGd,cAAH,aAAGA,cAAH,uBAAGA,cAAc,CAAEE,MAAhB,CAAuBC,GAAG,IAAIA,GAAG,CAACQ,OAAJ,KAAgBC,GAA9C,EAAmD,CAAnD,CAAnB;AACAG,IAAAA,OAAO,CAACC,GAAR,CAAYF,UAAZ;AAGA,UAAMG,KAAK,GAAGnB,IAAI,CAACa,OAAL,CAAaJ,GAAb,CAAiBW,IAAI,IAAI;AACrC,aAAO;AACLd,QAAAA,EAAE,EAAEc,IAAI,CAACd,EADJ;AAELe,QAAAA,KAAK,EAAED,IAAI,CAACC,KAFP;AAGLC,QAAAA,KAAK,EAAE;AACLC,UAAAA,QAAQ,EAAEH,IAAI,CAACI,WADV;AAELC,UAAAA,MAAM,EAAEL,IAAI,CAACE,KAFR;AAGLI,UAAAA,QAAQ,EAAEN,IAAI,CAACE,KAAL,GAAaP,IAAI,CAACY,KAAL,CAAWP,IAAI,CAACE,KAAhB,CAHlB,CAGyC;;AAHzC,SAHF;AAQLM,QAAAA,OAAO,EAAER,IAAI,CAACS,SART;AASLC,QAAAA,SAAS,EAAEV,IAAI,CAACU,SATX;AAULC,QAAAA,aAAa,EAAEX,IAAI,CAACY,QAAL,CAAcD,aAVxB;AAWLE,QAAAA,KAAK,EAAEb,IAAI,CAACc,cAAL,CAAoBD,KAApB,CAA0BtB;AAX5B,OAAP;AAaD,KAda,CAAd;;AAgBA,YAAQZ,MAAR;AACE,WAAK,KAAL;AACEH,QAAAA,GAAG,CAACuC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBC,UAAAA,MAAM,EAAE;AACN1B,YAAAA,IAAI,EAAE,aADA;AAEN2B,YAAAA,QAAQ,EAAE;AAFJ,WADW;AAKnB9B,UAAAA,UAAU,EAAEA,UALO;AAMnBW,UAAAA,KAAK,EAAEA;AANY,SAArB;AAQA;;AAEF;AACEvB,QAAAA,GAAG,CAAC2C,SAAJ,CAAc,OAAd,EAAuB,CAAC,KAAD,CAAvB;AACA3C,QAAAA,GAAG,CAACuC,MAAJ,CAAW,GAAX,EAAgBK,GAAhB,CAAqB,UAASzC,MAAO,cAArC;AAdJ;AAgBD,GA1CD,CA0CE,OAAO0C,KAAP,EAAc;AACdxB,IAAAA,OAAO,CAACC,GAAR,CAAYuB,KAAZ;AACD;AAEF","sourcesContent":["import axios from 'axios'\n\nexport default async function itemsHandler(req, res) {\n  const {\n    query: { q },\n    method,\n  } = req\n  try {\n    const { data } = await axios.get(`https://api.mercadolibre.com/sites/MLA/search?q=${q}`);\n    const findCategories = data.available_filters?.filter(cat => cat.id === 'category')[0]?.values\n    const categories = findCategories ? findCategories.map(val => val.name) : []\n    var arr = findCategories ? findCategories.map(val => val.results) : [];\n    var max = Math.max(...arr)\n    const breadCrumb = findCategories?.filter(cat => cat.results === max)[0]\n    console.log(breadCrumb)\n\n\n    const items = data.results.map(item => {\n      return {\n        id: item.id,\n        title: item.title,\n        price: {\n          currency: item.currency_id,\n          amount: item.price,\n          decimals: item.price - Math.floor(item.price) //no entendi bien de donde sacar los decimales, asi que lo calculo respecto al amount\n        },\n        picture: item.thumbnail,\n        condition: item.condition,\n        free_shipping: item.shipping.free_shipping,\n        state: item.seller_address.state.name\n      }\n    })\n\n    switch (method) {\n      case 'GET':\n        res.status(200).json({\n          author: {\n            name: 'Juan Manuel',\n            lastname: 'Barreto Zacarias'\n          },\n          categories: categories,\n          items: items\n        })\n        break\n\n      default:\n        res.setHeader('Allow', ['GET'])\n        res.status(405).end(`Method ${method} Not Allowed`)\n    }\n  } catch (error) {\n    console.log(error)\n  }\n\n}\n\n"]},"metadata":{},"sourceType":"module"}